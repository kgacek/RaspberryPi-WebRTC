syntax = "proto3";

package protocol;

// Command types for DataChannel communication
enum CommandType {
  CUSTOM = 0;
  TAKE_SNAPSHOT = 1;
  QUERY_FILE = 2;
  TRANSFER_FILE = 3;
  DISCONNECT = 4;
  CONTROL_CAMERA = 5;
  CONTROL_CAR = 10;  // NEW: For RC car control
}

// Car control command (throttle + steering)
message CarControlCommand {
  int32 throttle = 1;  // -500 to 500
  int32 steer = 2;     // -1000 to 1000
  uint32 seq = 3;      // Sequence number
}

// Snapshot request
message TakeSnapshotRequest {
  uint32 quality = 1;  // JPEG quality 0-100
}

// Query file request
message QueryFileRequest {
  string path = 1;
}

// Query file response
message QueryFileResponse {
  repeated string files = 1;
}

// Transfer file request  
message TransferFileRequest {
  string file_name = 1;
}

// Camera control request
message ControlCameraRequest {
  optional float brightness = 1;
  optional float contrast = 2;
  optional float saturation = 3;
  optional float sharpness = 4;
  optional float exposure_value = 5;
}

// Generic packet container
message Packet {
  CommandType type = 1;
  string payload = 2;  // For CUSTOM type
  
  // Request/response messages
  TakeSnapshotRequest take_snapshot_request = 10;
  QueryFileRequest query_file_request = 11;
  QueryFileResponse query_file_response = 12;
  TransferFileRequest transfer_file_request = 13;
  ControlCameraRequest control_camera_request = 14;
  CarControlCommand car_control_command = 15;  // NEW
  
  // Streaming metadata
  uint64 offset = 20;
  uint64 length = 21;
}
